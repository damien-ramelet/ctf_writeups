# PHIlosophy - Crypto

### Challenge description

Clam decided to start studying philosophy, and what is the difference between plus one and minus one anyway...

### Challenge code

```python
from Crypto.Util.number import getPrime
from secret import flag

p = getPrime(512)
q = getPrime(512)

m = int.from_bytes(flag.encode(), "big")

n = p * q
e = 65537
c = pow(m, e, n)

phi = (p + 1) * (q + 1)

print(f"n: {n}")
print(f"e: {e}")
print(f"c: {c}")
print(f"\"phi\": {phi}")

"""
n: 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084554536903236375579771401257801115918586590639686117179685431627540567894983403579070366895343181435791515535593260495162656111028487919107927692512155290673
e: 65537
c: 64457111821105649174362298452450091137161142479679349324820456191542295609033025036769398863050668733308827861582321665479620448998471034645792165920115009947792955402994892700435507896792829140545387740663865218579313148804819896796193817727423074201660305082597780007494535370991899386707740199516316196758
"phi": 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084573410416063246853198167436938724585247461433706053188624379514833802770205501907568228388536548010385588837258085711058519777393945044905741975952241886308
"""
```


---

### Solution

We are given what appears to be a classic RSA challenge. Using `pycryptodome` library, primes `p` and `q` are generated. Using the public key `e = 65537` the plain text `m` is then ciphered. We are given the modulus `n`, the public key, the ciphertext obtain as output... and phi. 

Wait, what ? `phi` is the [Euler's totient function](https://en.wikipedia.org/wiki/Euler%27s_totient_function). `phi` is used to compute the private key from the public key. Having `phi` and the public key is equivalent to having the private key.

However, something is wrong. `phi` formula isn’t right here, it should be `(p - 1)*(q - 1)`. That what the challenge description was about.

Can we retrieve the right `phi` value from this ? Let’s try.

We have:

`wrong_phi = (p + 1) * (q + 1)`

Which is equivalent to

`wrong_phi = pq + p + q + 1` or even `wrong_phi = n + p + q + 1`

Which means we have

`wrong_phi - n - 1 = p + q`

So we can easily retrieve the value of `p + q`.

Now, on the other hand, we have:

`phi = (p - 1) * (q - 1)`

Which is equivalent to

`phi = pq - p - q + 1` or even `phi = n - (p + q) + 1`. From this point, we have won. We can substitute `(p + q)` and retrieve
the real value of `phi`, compute the private key and decipher the ciphered text.

```python
In [1]: from Crypto.Util.number import long_to_bytes
   ...: n = 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084554536903236375579771401257801115918586590639686117179685431627540567894983403579070366895343181435791515535
   ...: 593260495162656111028487919107927692512155290673
   ...: e = 65537
   ...: c = 64457111821105649174362298452450091137161142479679349324820456191542295609033025036769398863050668733308827861582321665479620448998471034645792165920115009947792955402994892700435507896792829140545387740663865218579313148804819896796193817727423074201660305082
   ...: 597780007494535370991899386707740199516316196758
   ...: wrong_phi = 860887194529326259281887977002120363856458514922814810882898778291091102031245458528279767987043643931824269009323804365515698670368711714001907869130845734104160632468531981674369387245852474614337060531886243795148338027702055019075682283885365480103
   ...: 85588837258085711058519777393945044905741975952241886308

In [2]: phi = n - (wrong_phi - n - 1) + 1

In [3]: d = pow(e, -1, phi)

In [4]: long_to_bytes(pow(c, d, n))
Out[4]: b'actf{its_okay_i_figured_out_phi_anyway}'
```

Flag !

